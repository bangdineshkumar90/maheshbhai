<!DOCTYPE html>
<html>
<head>
  <title>Shop | Maheshbhai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
}

/* HEADER */
header{
  background:linear-gradient(90deg,#ff6a00,#ffcc00);
  padding:20px;
  text-align:center;
  font-size:26px;
  font-weight:bold;
  color:black;
  position:relative;
}

.cart-btn{
  position:absolute;
  right:20px;
  top:20px;
  background:black;
  color:#ffcc00;
  padding:8px 16px;
  border-radius:30px;
  text-decoration:none;
  font-weight:bold;
}

.cart-count{
  background:red;
  padding:2px 7px;
  border-radius:50%;
  font-size:12px;
  margin-left:5px;
}

/* FILTER SECTION */
.filters{
  display:flex;
  flex-wrap:wrap;
  gap:15px;
  justify-content:center;
  padding:20px;
}

.filters input,
.filters select{
  padding:10px 15px;
  border-radius:30px;
  border:none;
  outline:none;
  font-weight:500;
}

/* PRODUCTS */
.products{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:25px;
  padding:40px;
}

.card{
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(12px);
  border-radius:20px;
  padding:20px;
  text-align:center;
  transition:0.4s;
  position:relative;
  box-shadow:0 10px 25px rgba(0,0,0,0.4);
}

.card:hover{
  transform:translateY(-10px);
}

.card img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:15px;
}

.discount{
  position:absolute;
  top:15px;
  left:15px;
  background:red;
  padding:5px 10px;
  border-radius:20px;
  font-size:13px;
  font-weight:bold;
}

.stock{
  margin-top:8px;
  font-size:14px;
}

.in-stock{
  color:#00ff88;
}

.out-stock{
  color:#ff4d4d;
}

.title{
  font-size:20px;
  margin:15px 0 5px;
}

.price{
  margin:10px 0;
}

.old{
  text-decoration:line-through;
  color:#aaa;
  margin-right:8px;
}

.new{
  color:#ffcc00;
  font-weight:bold;
  font-size:20px;
}

.btn{
  background:linear-gradient(90deg,#ff6a00,#ffcc00);
  border:none;
  padding:10px 20px;
  border-radius:30px;
  cursor:pointer;
  font-weight:bold;
  transition:0.3s;
}

.btn:disabled{
  background:gray;
  cursor:not-allowed;
}

/* POPUP */
.toast{
  position:fixed;
  bottom:30px;
  right:30px;
  background:#00c853;
  padding:15px 20px;
  border-radius:10px;
  opacity:0;
  transform:translateY(20px);
  transition:0.4s;
}

.toast.show{
  opacity:1;
  transform:translateY(0);
}
</style>
</head>

<body>

<header>
ðŸ”¥ Premium Festive Collection ðŸ”¥
<a href="cart.html" class="cart-btn">
Cart ðŸ›’ <span id="cartCount" class="cart-count">0</span>
</a>
</header>

<div class="filters">
  <input type="text" id="searchInput" placeholder="Search products...">
  
  <select id="categoryFilter">
    <option value="">All Categories</option>
  </select>

  <select id="sortSelect">
    <option value="">Sort By</option>
    <option value="low">Price: Low to High</option>
    <option value="high">Price: High to Low</option>
  </select>
</div>

<div class="products" id="product-list"></div>

<div class="toast" id="toast">Added to Cart âœ…</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAf8oqme5drWgAxCdaFnMPWSYszsHU2odE",
  authDomain: "maheshbhai-store.firebaseapp.com",
  projectId: "maheshbhai-store",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let products = [];
let cart = JSON.parse(localStorage.getItem("cart")) || [];

const productList = document.getElementById("product-list");
const searchInput = document.getElementById("searchInput");
const categoryFilter = document.getElementById("categoryFilter");
const sortSelect = document.getElementById("sortSelect");
const toast = document.getElementById("toast");

function updateCartCount(){
  const totalQty = cart.reduce((sum,item)=>sum+item.qty,0);
  document.getElementById("cartCount").innerText = totalQty;
}

function showToast(){
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),2000);
}

function addToCart(product){

  if(product.stock <= 0) return;

  let existing = cart.find(item=>item.name===product.name);

  if(existing){
    existing.qty += 1;
  } else {
    cart.push({
      name:product.name,
      price:product.price,
      image:product.image,
      qty:1
    });
  }

  localStorage.setItem("cart",JSON.stringify(cart));
  updateCartCount();
  showToast();
}

function renderProducts(filteredProducts){

  productList.innerHTML="";

  filteredProducts.forEach(product=>{

    const discount = product.oldPrice
      ? Math.round(((product.oldPrice - product.price)/product.oldPrice)*100)
      : 0;

    productList.innerHTML += `
    <div class="card">
      ${discount>0?`<div class="discount">${discount}% OFF</div>`:""}
      <img src="${product.image}">
      <div class="title">${product.name}</div>
      <div class="price">
        ${product.oldPrice?`<span class="old">â‚¹${product.oldPrice}</span>`:""}
        <span class="new">â‚¹${product.price}</span>
      </div>
      <div class="stock ${product.stock>0?'in-stock':'out-stock'}">
        ${product.stock>0?`In Stock (${product.stock})`:"Out of Stock"}
      </div>
      <button class="btn" 
        ${product.stock<=0?'disabled':''}
        onclick='addToCart(${JSON.stringify(product)})'>
        ${product.stock>0?"Add to Cart ðŸ›’":"Out of Stock"}
      </button>
    </div>
    `;
  });
}

function applyFilters(){
  let filtered = [...products];

  const search = searchInput.value.toLowerCase();
  if(search){
    filtered = filtered.filter(p=>p.name.toLowerCase().includes(search));
  }

  const category = categoryFilter.value;
  if(category){
    filtered = filtered.filter(p=>p.category===category);
  }

  const sort = sortSelect.value;
  if(sort==="low"){
    filtered.sort((a,b)=>a.price-b.price);
  }
  if(sort==="high"){
    filtered.sort((a,b)=>b.price-a.price);
  }

  renderProducts(filtered);
}

async function loadProducts(){
  const snapshot = await getDocs(collection(db,"products"));

  snapshot.forEach(doc=>{
    products.push(doc.data());
  });

  // Load categories dynamically
  const categories = [...new Set(products.map(p=>p.category).filter(Boolean))];
  categories.forEach(cat=>{
    categoryFilter.innerHTML += `<option value="${cat}">${cat}</option>`;
  });

  renderProducts(products);
}

searchInput.addEventListener("input",applyFilters);
categoryFilter.addEventListener("change",applyFilters);
sortSelect.addEventListener("change",applyFilters);

window.addToCart = addToCart;

updateCartCount();
loadProducts();

</script>

</body>
</html>
